# 微服务高可用



## 如何保证服务的高可用（服务治理）

通过**服务治理**来保障服务的高可用，原则：
1. 减少发生：降低故障出现频次
2. 降低影响：一旦发生，确保尽可能小的影响面
3. 尽快恢复：能够快速发现、定位、修复

### 减少发生：降低故障出现频次

1. 架构
    - Design for Failures
    - 自身异常、下游异常
    - 合理的容量评估
2. 编码
    - 代码性能、安全性、可测性
    - 高内聚、低耦合，严谨的编码，主动容错
    - 全分支覆盖自测，CodeReview
3. 测试
    - 功能测试
    - 性能测试
    - 稳定性/兼容性/安全性测试
4. 上线
    - 蓝绿发布、回归测试
    - 快速回滚
    - 重视数据变更的风险

### 降低影响：一旦发生，确保尽可能小的影响面

1. 服务限流：入口流量调度
2. 服务熔断、降级
3. 智能路由（负载均衡）

### 尽快恢复：能够快速发现、定位、修复

1. 监控报警
   - Prometheus
   - Grafana
   - SkyWorking
2. 快速回滚
3. 预案与演练
   - 把预案内容转换为系统的设计和实现
   - 优先从系统设计和实现角度保证可用性
   - 制造真实故障，定期演练


