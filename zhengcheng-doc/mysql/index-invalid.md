# MySQL 索引失效

## MySQL 索引在 in 条件下失效的原因

首先我们看`IN`索引失效的情况：
![in-1](/img/mysql/in-1.jpg)
从执行计划看到`type=ALL，Extra=Using where`走的是全表扫描，索引失效。

那么`IN`索引失效的情况分为以下几种（其他的索引失效，也可以参考）

1. 类型不匹配，当索引字段是字符串时，查询的参数也必须是字符串。
2. 数据量
    - 如果数据量很小，`MySQL`会认为扫描全表比使用索引快，自然不会走索引（优化器）
    - 如果查询结果数据量很多，`MySQL`也不会使用索引。
**可以通过加上`limit`来解决这个问题**。
3. 排序问题

通过以上的分析，上面的索引失效情况可以通过加上`limit`来解决，如下图:
![in-2](/img/mysql/in-2.jpg)
